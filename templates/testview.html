{% load extra %}
<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/bootswatch/3.0.0/slate/bootstrap.min.css" rel="stylesheet">

    <style type='text/css'>
    div.overlay {
        z-index:1;
        display: block;
        position: absolute;
        padding: 5px;
        width: 125px;
        height: 55px;
        cursor: pointer;
    }
    div.line {
        position: absolute;
        -webkit-transform-origin: 0 50%;
        -moz-transform-origin: 0 50%;
        transform-origin: 0 50%;
        /* Line width*/
        height: 2px;
        background: white;
        opacity:1.0;
    }
    .circle {
        border-radius: 50%;
        display: block;
        position: absolute;
        margin-right: 20px;
        border-style: solid;
        border-width: 2px;
        background: white;
        width: 15px;
        height: 15px;
        opacity: 0.5;
        top: 0px;
        left: 0px;
    }
    </style>
    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    {% load static %}
    <script type='text/javascript' src='{% static "js/app.js" %}'></script>
    
    <script type='text/javascript' defer='defer'>
    // The Javascript embedded directly into the file here is all the script that
    // needs to be dynamically generated by the template, or code that needs to run
    // after that dynamically generated code.  Everything else should be in app.js
    $(window).load(function(){
        {% block head_script %}
        function createHardpoint(id, x1, y1, x2, y2, hardpoint_class) {
            var overlay = $('#hardpoint_' + id);
            var speed = 600;
            var parentImage = overlay.closest('.image_container')

            // DEBUG
            console.log(overlay)
            moveToAbsoluteXY(overlay, x1, y1, speed);
            console.log(parentImage);
            // adjust x1,y1 to center in the overlay div
            x1 = x1 + (overlay.width() / 2);
            y1 = y1 + ((overlay.height() + 20)/ 2);
            // create the line from overlay to point on ship image
            setTimeout(createLine, speed, parentImage, x1, y1, x2, y2, id);
            // create the dot at the end of the line on the ship image
            setTimeout(createDot, speed + 400, parentImage, x2, y2, 15, id);

        }

        function initHardpoints() {
            var hardpoints = $('.overlay');
            hardpoints.each( function(index) {
                var hardpointID = $(this).attr('data-hardpoint-id');
                var hardpointClass = $(this).attr('data-hardpoint-class');
                var x1 = parseInt($(this).attr('data-hardpoint-posx'), 10);
                var y1 = parseInt($(this).attr('data-hardpoint-posy'), 10);
                var x2 = parseInt($(this).attr('data-tag-posx'), 10);
                var y2 = parseInt($(this).attr('data-tag-posy'), 10);
                createHardpoint(hardpointID, x1, y1, x2, y2, hardpointClass);
            });
        }
        {% endblock head_script %}

        {% block script_event_triggers %}
        {% endblock script_event_triggers %}

        {% block global_actions_script %}
        {% endblock global_actions_script %}

        {% block user_actions_script %}
        {% endblock user_actions_script %}

        {% block final_script_actions %}
        // update ship mass with items loaded
        // updateStats();
        // place hardpoint overlays in correct position, and draw lines and tags
        initHardpoints();
        $('[data-toggle=tooltip]').tooltip();
        $('[data-toggle=popover]').popover();
        {% endblock final_script_actions %}
    });
    </script>
    <title>Bootstrap 101 Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <h1>{{ship}}</h1>
    <div class="row">
      <div class="col-sm-3">{{ship.name}} by {{ship.manufacturer}}</div>
    </div>
    {% for image in image_list %}
    <div class='row'>
        {% if forloop.first %}
        <div class='col-lg-3 col-lg-push-9'>
            <div class="panel panel-primary">
              <div class="panel-heading">
                <h3 class="panel-title">Panel primary</h3>
              </div>
              <div class="panel-body">
                Panel content
               <button type="button" class="btn btn-default" data-container="body" data-toggle="popover" data-placement="right" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus.">
          Popover on right
        </button>
              </div>
            </div>
        </div>
        {% endif %}
        <div class='col-lg-6 {%if not forloop.first %}col-lg-push-3{% endif %}'>
            <div class="image_container" id='ship_image_{{image.id}}'>
                <img class='ship' src='{{image.url}}'>
                {% for hardpoint in image.hardpoint_set.all %}
                <div class='panel overlay col-sm-3 ui-widget ui-widget-content ui-corner-all' id='hardpoint_{{hardpoint.id}}' data-hardpoint-id='{{hardpoint.id}}'  data-hardpoint-class='{{hardpoint.hardpoint_class}}' data-hardpoint-posx='{{hardpoint.overlay_location_x}}' data-hardpoint-posy='{{hardpoint.overlay_location_y}}' data-tag-posx='{{hardpoint.tag_location_x}}' data-tag-posy='{{hardpoint.tag_location_y}}'>Class {{hardpoint.hardpoint_class}} Hardpoint
                    <span class='current_selection' data-hardpoint-id='{{hardpoint.id}}'>
                        <div class='current_selection item'><button type="button" class="btn btn-default" data-container="body" data-toggle="popover" data-placement="right" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus.">Select Item</button></div>
                    </span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
   {% endfor %}
  </body>
</html>