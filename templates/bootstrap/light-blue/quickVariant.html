{% extends "bootstrap/light-blue/base.html" %}
{% load static %}
{% block head %}
{{block.super}}
{% endblock head %}

{% block pre-content %}
<div id="user-login" class="modal hide fade" tabindex="-1" role="dialog">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">X</button>
        <h3>Pilot Login</h3>
    </div>
    <div class="modal-body">
        <form name='login-form' id='login-form' method='POST' action='/users/login/'>
            {{ loginForm.as_p}}
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" aria-hidden="true" onclick="submitUserLogin()">Submit</button>
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>

<div id="user-newuser" class="modal hide fade" tabindex="-1" role="dialog">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">X</button>
        <h3>Create New Pilot</h3>
    </div>
    <div class="modal-body">
        <form name='newuser-form' id='newuser-form' method='POST' action='/users/create/'>
            {{ createUserForm.as_p}}
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" aria-hidden="true" onclick="submitNewUser()">Submit</button>
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>

<div id="quick-variant" class="modal hide fade wide" tabindex="-1" role="dialog">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">X</button>
        <h3>QuickVariant</h3>
    </div>
    <div class="modal-body">
        <h5>Here is Your Quick Variant URL</h5>
        <p>This URL is a snapshot of this current ship configuration.  It is static and will always display exactly what you see now.  If you make changes to this configuration you will need to request a new link.</p>
        <div id="quickvariant-url"></div>        
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" aria-hidden="true" onclick="gotoQuickVariant()">Go To QuickVariant</button>
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>

<div id="item-details-modal" class="modal hide fade dark" tabindex="-1" role="dialog">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">X</button>
        <h3 id="item-details-itemname">Item Name</h3>
    </div>
    <div class="modal-body">
        <div id="item-details-body">
            <table class="table" id="item-details-basics">
                <tbody>
                <tr class="label-inverse">
                    <td>Class</td>
                    <td id="item-details-itemclass"></td>
                    <td>Size</td>
                    <td id="item-details-itemsize"></td>
                </tr>
                </tbody>
            </table>
            <div>
            <span id="item-details-itemtype"></span><span>: </span><span id="item-details-itemsubtype"></span>
            </div>
            <div id="item-details-description">
            </div>
            <div id="item-details-weaponbars">
            </div>
            <div id="item-details-misc">
            </div>
        </div>
        <div>
            <header>
                <h4 id="power-chart-header">Power</h4>
            </header>
            <div id="power-chart-line" class="visits-chart">
                <svg>
                </svg>
            </div>
        </div>
        <div>
            <header>
                <h4 id="heat-chart-header">Heat</h4>
            </header>
            <div id="heat-chart-line" class="body chart">
                <svg></svg>
            </div>
        </div>
        <div>
            <header>
                <h4 id="avionics-chart-header">Avionics</h4>
            </header>
            <div id="avionics-chart-line" class="body chart">
                <svg></svg>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>
<div id="itemport-details-modal" class="modal hide fade dark" tabindex="-1" role="dialog">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" >Ã—</button>
        <h4 id="itemport-details-name">Itemport Name</h4>
    </div>
    <div class="modal-body">
        <div id="itemport-details-body">
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>
{% endblock pre-content %}

{% block page-header %}Workshop{% endblock page-header %}
        {% block main-content %}
        <div class="row-fluid">
            <div class="span8" id="ship-images">
                <section class="widget">
                    <header>
                        <h2 class="page-title">{% block page-title %}{{shipData.displayName}}{% endblock page-title %}</h2>
                    </header>
                    <div class="body">
                        <div class="tabbable tabs-top">
                            <ul id="layout-images" class="nav nav-tabs">
                                <li class="active"><a href="#image-topright" data-toggle="tab">Top Right</a></li>
                                <li><a href="#image-topleft" data-toggle="tab">Top Left</a></li>
                                <li><a href="#image-bottomright" data-toggle="tab">Bottom Right</a></li>
                                <li><a href="#image-bottomleft" data-toggle="tab">Bottom Left</a></li>
                                <li><a href="#hardpoints-overview" data-toggle="tab">Systems Overview</a></li>
                            </ul>
                            <div id="layout-images-content" class="tab-content" >
                                <div class="tab-pane fade in active" id="image-topright">
                                    <div style="position:relative">
                                        <image src="{{shipData.layoutImageTopRight}}"></image>
                                        {% for port in shipData.itemport_set.all %}
                                            {% if port.parentImage == 1%}
                                            <div class="item-port {%for type in port.supportedTypes.all%}{{type.typeName}} {%endfor%}" style="left:{{port.tagLocationX}}%;top:{{port.tagLocationY}}%;" data-types="{%for type in port.supportedTypes.all%}{{type.typeName}}{%if not forloop.last %},{%endif%}{%endfor%}" data-subtypes="{%for type in port.supportedSubTypes.all%}{{type.subTypeName}}{%if not forloop.last %},{%endif%}{%endfor%}" data-min-size={{port.minSize}} data-max-size={{port.maxSize}} id="{{port.name}}" data-parent={{port.parentImage}}></div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="image-topleft">
                                    <div style="position:relative">
                                        <image src="{{shipData.layoutImageTopLeft}}"></image>
                                        {% for port in shipData.itemport_set.all %}
                                            {% if port.parentImage == 2%}
                                            <div class="item-port {%for type in port.supportedTypes.all%}{{type.typeName}} {%endfor%}" style="left:{{port.tagLocationX}}%;top:{{port.tagLocationY}}%;" data-types="{%for type in port.supportedTypes.all%}{{type.typeName}}{%if not forloop.last %},{%endif%}{%endfor%}" data-subtypes="{%for type in port.supportedSubTypes.all%}{{type.subTypeName}}{%if not forloop.last %},{%endif%}{%endfor%}" data-min-size={{port.minSize}} data-max-size={{port.maxSize}} id="{{port.name}}" data-parent={{port.parentImage}}></div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="image-bottomright">
                                    <div style="position:relative">
                                        <image src="{{shipData.layoutImageBottomRight}}"></image>
                                        {% for port in shipData.itemport_set.all %}
                                            {% if port.parentImage == 3%}
                                            <div class="item-port {%for type in port.supportedTypes.all%}{{type.typeName}} {%endfor%}" style="left:{{port.tagLocationX}}%;top:{{port.tagLocationY}}%;" data-types="{%for type in port.supportedTypes.all%}{{type.typeName}}{%if not forloop.last %},{%endif%}{%endfor%}" data-subtypes="{%for type in port.supportedSubTypes.all%}{{type.subTypeName}}{%if not forloop.last %},{%endif%}{%endfor%}" data-min-size={{port.minSize}} data-max-size={{port.maxSize}} id="{{port.name}}" data-parent={{port.parentImage}}></div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="image-bottomleft">
                                    <div style="position:relative">
                                        <image src="{{shipData.layoutImageBottomLeft}}"></image>
                                        {% for port in shipData.itemport_set.all %}
                                            {% if port.parentImage == 4%}
                                            <div class="item-port {%for type in port.supportedTypes.all%}{{type.typeName}} {%endfor%}" style="left:{{port.tagLocationX}}%;top:{{port.tagLocationY}}%;" data-types="{%for type in port.supportedTypes.all%}{{type.typeName}}{%if not forloop.last %},{%endif%}{%endfor%}" data-subtypes="{%for type in port.supportedSubTypes.all%}{{type.subTypeName}}{%if not forloop.last %},{%endif%}{%endfor%}" data-min-size={{port.minSize}} data-max-size={{port.maxSize}} id="{{port.name}}" data-parent={{port.parentImage}}></div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="hardpoints-overview">
                                    <section>
                                    {% for itemPort in shipData.itemport_set.all %}
                                        {% if forloop.counter0|divisibleby:3 %}</section><section>{% endif %}
                                        <div class="span4">
                                            <div class="well item-port-datablock" data-port-name="{{itemPort.name}}" data-parent={{itemPort.parentImage}} data-min-size={{itemPort.minSize}} data-max-size={{itemPort.maxSize}} data-subtypes="{%for type in itemPort.supportedSubTypes.all%}{{type.subTypeName}}{%if not forloop.last %},{%endif%}{%endfor%}">
                                                <p class="label label-inverse">{% firstof itemPort.displayName itemPort.name %}</p><i class="icon-remove pull-right icon-large"></i><i class="icon-filter pull-right icon-large"></i>
                                                <br>
                                                
                                                <div class="item-port-datablock-statebuttons">
                                                    <input id="item-powerstate-{{itemPort.name}}-input" type="hidden" name="item-powerstate" value="Default">
                                                    <div class="btn-group" id="port-powerstate-{{itemPort.name}}" data-toggle="buttons-radio" data-target="item-powerstate-{{itemPort.name}}-input">
                                                        <button class="btn btn-mini btn-info active" data-toggle-class="btn-info" data-toggle-passive-class="btn-inverse" type="button" value="Default">Default</button>
                                                    </div>
                                                </div>
                                                <br><span class="item-name">Nothing Loaded</span>
                                            </div>
                                        </div>
                                    {% endfor %}
                                    </section>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="widget">
                    <header>
                        <h4>Systems Monitor & Calibration</h4>
                    </header>
                    <div class="body">
                        <div class="tabbable tabs-below">
                            <div id="systems-monitor-content" class="tab-content">
                                <div id="systems-overview" class="tab-pane fade in active">
                                    <h4>Systems Snapshot provides a snapshot of vehicle resources</h4>
                                    <p>The systems snapshot provides a quick look at vehicle resource usage based on all modules running in the default or active state.  For more detailed diagnostics turn to the LiveStats Diagnostic System</p>
                                    <h5>Power Consumption: <strong><span id="stats-available-power-label">0</span></strong></h5>
                                    <p id="stats-warning-missingpowerplant"><span class="label label-important">Warning No Powerplant equipped</span></p>
                                    <div class="progress progress-small progress-success" id="stats-available-power-container">
                                        <div class="bar" style="width:0%;" id="stats-available-power-bar">
                                        </div>
                                    </div>
                                </div>
                                <div id="systems-livestats" class="tab-pane fade">
                                    <h4>The MobiGlas patented LiveStats Diagnostic System (LDS) provides detailed statistics on vehicle resource usage</h4>
                                    <p>Designed to operate in conjunction with the Systems Overview panel, LDS can give you down to the second reporting on resource usage based on individual hardpoint states.  As you change hardpoint states in the Systems Overview, LDS will update in realtime.  Never be caught off guard with MobiGlas LDS.</p>
                                    <h5>Power Consumption: <strong><span id="stats-lds-available-power-label">0</span></strong></h5>
                                    <p id="stats-lds-warning-missingpowerplant"><span class="label label-important">Warning No Powerplant equipped</span></p>
                                    <div class="progress progress-small progress-success" id="stats-lds-available-power-container">
                                        <div class="bar" style="width:0%;" id="stats-lds-available-power-bar">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <ul id="systems-monitor" class="nav nav-tabs">
                                <li class="active"><a href="#systems-overview" data-toggle="tab">Snapshot</a></li>
                                <li><a href="#systems-livestats" data-toggle="tab">LiveStats</a></li>
                            </ul>
                        </div>
                    </div>
                </section>
            </div>
            <div class="span4">
                <section class="widget">
                    <header>
                        <h4>Pilot Authentication</h4>
                    </header>
                    <div class="body">
                    <ul>
                        <li id="user-actions-login" style="display:none;"><a href="#" id="user-action-login">Log In</a></li>
                        <li id="user-actions-newuser" style="display:none;"><a href="#" id="user-action-newuser">Create Account</a></li>
                        <li id="user-actions-logout" style="display:none;"><a href="#" id="user-action-logout">Log Out</a></li>
                    </ul>
                    </div>
                </section>
                <section class="widget">
                    <header>
                        <h4>System Operations</h4>
                    </header>
                    <div class="body">
                    <ul>
                        <li id-"system-actions-save"><a href="#" id="system-action-save">Save Variant</a></li>
                        <li id="system-actions-quickvariant"><a href="#" id="system-action-quickvariant">Get QuickVariant</a></li>
                    </ul>
                    </div>
                </section>
                <section class="widget">
                    <header>
                        <h4>Compatible Items</h4>
                        <p class="label-highlight">Drag items to hardpoints to equip them<br/>
                        Click on items to see details</p>
                    </header>
                    <div class="body">
                        <div class="tabbable tabs-right">
                            <ul id="items-list" class="nav nav-tabs">
                                <li class="active"><a class="type-select" href="#hardpoints-Weapon" data-toggle="tab">Weapons</a></li>
                                <li><a class="type-select" href="#hardpoints-Thruster" data-toggle="tab">Thrusters</a></li>
                                <li><a class="type-select" href="#hardpoints-PowerPlant" data-toggle="tab">Powerplant</a></li>
                                <li><a class="type-select" href="#hardpoints-Container" data-toggle="tab">Cargo</a></li>
                                <li><a class="type-select" href="#hardpoints-Avionics" data-toggle="tab">Avionics</a></li>
                                <li><a class="type-select" href="#hardpoints-Battery" data-toggle="tab">Batteries</a></li>
                                <li><a class="type-select" href="#hardpoints-Cooler" data-toggle="tab">Coolers</a></li>
                                <li><a class="type-select" href="#hardpoints-Display" data-toggle="tab">Displays</a></li>
                                <li><a class="type-select" href="#hardpoints-Radar" data-toggle="tab">Radars</a></li>
                            </ul>
                            <div id="items-list-content" class="tab-content">
                                <div id="hardpoints-Weapon" class="tab-pane fade in active">
                                    <div id="table-dynamic-weapons"></div>
                                    <div></div>
                                    <h4>Hardpoints</h4>
                                    <p><span class="label-highlight">Use Systems Overview to see all hardpoints at once</span></p>
                                    {% for itemPort in shipData.itemport_set.all %}
                                        {% if itemPort.parentImage > 0 %}
                                            {% for itemType in itemPort.supportedTypes.all %}
                                                {% if itemType.typeName == "Weapon" %}
                                                    <div class="well item-port-label" data-port-name="{{itemPort.name}}" data-parent={{itemPort.parentImage}} data-min-size={{itemPort.minSize}} data-max-size={{itemPort.maxSize}} data-subtypes="{%for type in itemPort.supportedSubTypes.all%}{{type.subTypeName}}{%if not forloop.last %},{%endif%}{%endfor%}"><span class="label label-inverse" data-item-port="{{itemPort.name}}">{% firstof itemPort.displayName itemPort.name %}</span><i class="icon-remove pull-right icon-large"></i><br><span class="item-name">Nothing Loaded</div>
                                                {% endif %}
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <div id="hardpoints-Thruster" class="tab-pane fade">
                                    <div id="table-dynamic-thrusters"></div>
                                    <div></div>
                                    <h4>Hardpoints</h4>
                                    {% for itemPort in shipData.itemport_set.all %}
                                        {% if itemPort.parentImage > 0 %}
                                            {% for itemType in itemPort.supportedTypes.all %}
                                                {% if itemType.typeName == "Thruster" %}
                                                    <div class="well item-port-label" data-port-name="{{itemPort.name}}" data-parent={{itemPort.parentImage}} data-min-size={{itemPort.minSize}} data-max-size={{itemPort.maxSize}} data-subtypes="{%for type in itemPort.supportedSubTypes.all%}{{type.subTypeName}}{%if not forloop.last %},{%endif%}{%endfor%}"><span class="label label-inverse" data-item-port="{{itemPort.name}}">{% firstof itemPort.displayName itemPort.name %}</span><i class="icon-remove pull-right icon-large"></i><br><span class="item-name">Nothing Loaded</div>
                                                {% endif %}
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <div id="hardpoints-PowerPlant" class="tab-pane fade">
                                    <div id="table-dynamic-powerplants"></div>
                                    <div></div>
                                    <h4>Hardpoints</h4>
                                    {% for itemPort in shipData.itemport_set.all %}
                                        {% if itemPort.parentImage > 0 %}
                                            {% for itemType in itemPort.supportedTypes.all %}
                                                {% if itemType.typeName == "PowerPlant" %}
                                                    <div class="well item-port-label" data-port-name="{{itemPort.name}}" data-parent={{itemPort.parentImage}} data-min-size={{itemPort.minSize}} data-max-size={{itemPort.maxSize}} data-subtypes="{%for type in itemPort.supportedSubTypes.all%}{{type.subTypeName}}{%if not forloop.last %},{%endif%}{%endfor%}"><span class="label label-inverse" data-item-port="{{itemPort.name}}">{% firstof itemPort.displayName itemPort.name %}</span><i class="icon-remove pull-right icon-large"></i><br><span class="item-name">Nothing Loaded</div>
                                                {% endif %}
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <div id="hardpoints-Container" class="tab-pane fade">
                                    <div id="table-dynamic-cargo"></div>
                                    <div></div>
                                    <h4>Hardpoints</h4>
                                    {% for itemPort in shipData.itemport_set.all %}
                                        {% if itemPort.parentImage > 0 %}
                                            {% for itemType in itemPort.supportedTypes.all %}
                                                {% if itemType.typeName == "Container" %}
                                                    <div class="well item-port-label" data-port-name="{{itemPort.name}}" data-parent={{itemPort.parentImage}} data-min-size={{itemPort.minSize}} data-max-size={{itemPort.maxSize}} data-subtypes="{%for type in itemPort.supportedSubTypes.all%}{{type.subTypeName}}{%if not forloop.last %},{%endif%}{%endfor%}"><span class="label label-inverse" data-item-port="{{itemPort.name}}">{% firstof itemPort.displayName itemPort.name %}</span><i class="icon-remove pull-right icon-large"></i><br><span class="item-name">Nothing Loaded</div>
                                                {% endif %}
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <div id="hardpoints-Avionics" class="tab-pane fade">
                                    <div id="table-dynamic-avionics"></div>
                                    <div></div>
                                    <h4>Hardpoints</h4>
                                    {% for itemPort in shipData.itemport_set.all %}
                                        {% if itemPort.parentImage > 0 %}
                                            {% for itemType in itemPort.supportedTypes.all %}
                                                {% if itemType.typeName == "Avionics" %}
                                                    <div class="well item-port-label" data-port-name="{{itemPort.name}}" data-parent={{itemPort.parentImage}} data-min-size={{itemPort.minSize}} data-max-size={{itemPort.maxSize}} data-subtypes="{%for type in itemPort.supportedSubTypes.all%}{{type.subTypeName}}{%if not forloop.last %},{%endif%}{%endfor%}"><span class="label label-inverse" data-item-port="{{itemPort.name}}">{% firstof itemPort.displayName itemPort.name %}</span><i class="icon-remove pull-right icon-large"></i><br><span class="item-name">Nothing Loaded</div>
                                                {% endif %}
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <div id="hardpoints-Battery" class="tab-pane fade">
                                    <div id="table-dynamic-batteries"></div>
                                    <div></div>
                                    <h4>Hardpoints</h4>
                                    {% for itemPort in shipData.itemport_set.all %}
                                        {% if itemPort.parentImage > 0 %}
                                            {% for itemType in itemPort.supportedTypes.all %}
                                                {% if itemType.typeName == "Battery" %}
                                                    <div class="well item-port-label" data-port-name="{{itemPort.name}}" data-parent={{itemPort.parentImage}} data-min-size={{itemPort.minSize}} data-max-size={{itemPort.maxSize}} data-subtypes="{%for type in itemPort.supportedSubTypes.all%}{{type.subTypeName}}{%if not forloop.last %},{%endif%}{%endfor%}"><span class="label label-inverse" data-item-port="{{itemPort.name}}">{% firstof itemPort.displayName itemPort.name %}</span><i class="icon-remove pull-right icon-large"></i><br><span class="item-name">Nothing Loaded</div>
                                                {% endif %}
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <div id="hardpoints-Cooler" class="tab-pane fade">
                                    <div id="table-dynamic-coolers"></div>
                                    <div></div>
                                    <h4>Hardpoints</h4>
                                    {% for itemPort in shipData.itemport_set.all %}
                                        {% if itemPort.parentImage > 0 %}
                                            {% for itemType in itemPort.supportedTypes.all %}
                                                {% if itemType.typeName == "Cooler" %}
                                                    <div class="well item-port-label" data-port-name="{{itemPort.name}}" data-parent={{itemPort.parentImage}} data-min-size={{itemPort.minSize}} data-max-size={{itemPort.maxSize}} data-subtypes="{%for type in itemPort.supportedSubTypes.all%}{{type.subTypeName}}{%if not forloop.last %},{%endif%}{%endfor%}"><span class="label label-inverse" data-item-port="{{itemPort.name}}">{% firstof itemPort.displayName itemPort.name %}</span><i class="icon-remove pull-right icon-large"></i><br><span class="item-name">Nothing Loaded</div>
                                                {% endif %}
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <div id="hardpoints-Display" class="tab-pane fade">
                                    <div id="table-dynamic-displays"></div>
                                    <div></div>
                                    <h4>Hardpoints</h4>
                                    {% for itemPort in shipData.itemport_set.all %}
                                        {% if itemPort.parentImage > 0 %}
                                            {% for itemType in itemPort.supportedTypes.all %}
                                                {% if itemType.typeName == "Display" %}
                                                    <div class="well item-port-label" data-port-name="{{itemPort.name}}" data-parent={{itemPort.parentImage}} data-min-size={{itemPort.minSize}} data-max-size={{itemPort.maxSize}} data-subtypes="{%for type in itemPort.supportedSubTypes.all%}{{type.subTypeName}}{%if not forloop.last %},{%endif%}{%endfor%}"><span class="label label-inverse" data-item-port="{{itemPort.name}}">{% firstof itemPort.displayName itemPort.name %}</span><i class="icon-remove pull-right icon-large"></i><br><span class="item-name">Nothing Loaded</div>
                                                {% endif %}
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <div id="hardpoints-Radar" class="tab-pane fade">
                                    <div id="table-dynamic-radar"></div>
                                    <div></div>
                                    <h4>Hardpoints</h4>
                                    {% for itemPort in shipData.itemport_set.all %}
                                        {% if itemPort.parentImage > 0 %}
                                            {% for itemType in itemPort.supportedTypes.all %}
                                                {% if itemType.typeName == "Radar" %}
                                                    <div class="well item-port-label" data-port-name="{{itemPort.name}}" data-parent={{itemPort.parentImage}} data-min-size={{itemPort.minSize}} data-max-size={{itemPort.maxSize}} data-subtypes="{%for type in itemPort.supportedSubTypes.all%}{{type.subTypeName}}{%if not forloop.last %},{%endif%}{%endfor%}"><span class="label label-inverse" data-item-port="{{itemPort.name}}">{% firstof itemPort.displayName itemPort.name %}</span><i class="icon-remove pull-right icon-large"></i><br><span class="item-name">Nothing Loaded</div>
                                                {% endif %}
                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        <div class="row-fluid">
        </div>
        {% endblock main-content %}
<!-- jquery and friends -->
<script src='{% static "js/jquery-1.9.1.js" %}'> </script>
<script src='{% static "theme/light-blue/lib/jquery/jquery-migrate-1.1.0.min.js" %}'> </script>

<!-- jquery plugins -->
<script src='{% static "theme/light-blue/lib/jquery-maskedinput/jquery.maskedinput.js" %}'></script>
<script src='{% static "theme/light-blue/lib/parsley/parsley.js" %}'> </script>
<script src='{% static "theme/light-blue/lib/icheck.js/jquery.icheck.js" %}'></script>
<script src='{% static "theme/light-blue/lib/select2.js" %}'></script>
<script type="text/javascript" src='{% static "js/jquery-ui-1.10.3.custom.min.js" %}'></script>
<script type='text/javascript' src='{% static "js/jquery.form.min.js" %}'></script>
<script type="text/javascript" src='{% static "js/jquery.hoverIntent.minified.js" %}'></script>

<!-- d3, nvd3-->
<script src='{% static "theme/light-blue/lib/nvd3/lib/d3.v2.js" %}'></script>
<script src='{% static "theme/light-blue/lib/nvd3/nv.d3.custom.js" %}'></script>

<!-- nvd3 models -->
<script src='{% static "theme/light-blue/lib/nvd3/src/models/scatter.js" %}'></script>
<script src='{% static "theme/light-blue/lib/nvd3/src/models/axis.js" %}'></script>
<script src='{% static "theme/light-blue/lib/nvd3/src/models/legend.js" %}'></script>
<script src='{% static "theme/light-blue/lib/nvd3/src/models/stackedArea.js" %}'></script>
<script src='{% static "theme/light-blue/lib/nvd3/src/models/stackedAreaChart.js" %}'></script>
<script src='{% static "theme/light-blue/lib/nvd3/src/models/line.js" %}'></script>
<script src='{% static "theme/light-blue/lib/nvd3/src/models/pie.js" %}'></script>
<script src='{% static "theme/light-blue/lib/nvd3/src/models/pieChartTotal.js" %}'></script>
<script src='{% static "theme/light-blue/lib/nvd3/stream_layers.js" %}'></script>
<script src='{% static "theme/light-blue/lib/nvd3/src/models/lineChart.js" %}'></script>
<script src='{% static "theme/light-blue/lib/nvd3/src/models/multiBar.js" %}'></script>
<script src='{% static "theme/light-blue/lib/nvd3/src/models/multiBarChart.js" %}'></script>

<!--backbone and friends -->
<script src='{% static "theme/light-blue/lib/backbone/underscore-min.js" %}'></script>
<script src='{% static "theme/light-blue/lib/backbone/backbone-min.js" %}'></script>
<script src='{% static "theme/light-blue/lib/backbone/backbone-pageable.js" %}'></script>
<script src='{% static "theme/light-blue/lib/backgrid/backgrid.js" %}'></script>
<script src='{% static "theme/light-blue/lib/backgrid/backgrid-paginator.js" %}'></script>

<!-- bootstrap default plugins -->
<script src='{% static "theme/light-blue/js/bootstrap/bootstrap.js" %}'></script>
<script src='{% static "theme/light-blue/js/bootstrap/bootstrap-transition.js" %}'></script>
<script src='{% static "theme/light-blue/js/bootstrap/bootstrap-collapse.js" %}'></script>
<script src='{% static "theme/light-blue/js/bootstrap/bootstrap-alert.js" %}'></script>
<script src='{% static "theme/light-blue/js/bootstrap/bootstrap-tooltip.js" %}'></script>
<script src='{% static "theme/light-blue/js/bootstrap/bootstrap-popover.js" %}'></script>
<script src='{% static "theme/light-blue/js/bootstrap/bootstrap-button.js" %}'></script>
<script src='{% static "theme/light-blue/js/bootstrap/bootstrap-dropdown.js" %}'></script>
<script src='{% static "theme/light-blue/js/bootstrap/bootstrap-modal.js" %}'></script>
<script src='{% static "theme/light-blue/js/bootstrap/bootstrap-tab.js" %}'> </script>

<!-- basic application js-->
<script src='{% static "theme/light-blue/js/app.js" %}'></script>
<script src='{% static "theme/light-blue/js/settings.js" %}'></script>
<script src='{% static "js/phase2_app.js" %}'></script>

{% block ready-script %}

/***************************************************************
// Dynamically Generated Variant Data
/**************************************************************/
var variantData = [
    {% for data in variantData %}
        { 
        'portName'          : "{{data.port.name}}",
        'itemName'          : "{{data.item.name}}",
        'itemDisplayName'   : "{{data.item.displayName}}"
        } {% if not forloop.last %},{% endif %}
    {% endfor %}
    ];

/***************************************************************
// Backgrid Table Setup
***************************************************************/
var Items = Backbone.Model.extend({});

var PageableAvionics = Backbone.PageableCollection.extend({
model: Items,
url : '/items/get/type/avionics/compatible-with-vehicle/{{shipData.name}}/',
state: {
    pageSize: 10
},
mode: "client" // page entirely on the client side
});
var PageableBatteries = Backbone.PageableCollection.extend({
model: Items,
url : '/items/get/type/battery/compatible-with-vehicle/{{shipData.name}}/',
state: {
    pageSize: 10
},
mode: "client" // page entirely on the client side
});
var PageableCooler = Backbone.PageableCollection.extend({
model: Items,
url : '/items/get/type/cooler/compatible-with-vehicle/{{shipData.name}}/',
state: {
    pageSize: 10
},
mode: "client" // page entirely on the client side
});
var PageableCargo = Backbone.PageableCollection.extend({
model: Items,
url : '/items/get/type/container/compatible-with-vehicle/{{shipData.name}}/',
state: {
    pageSize: 10
},
mode: "client" // page entirely on the client side
});
var PageableDisplays = Backbone.PageableCollection.extend({
model: Items,
url : '/items/get/type/display/compatible-with-vehicle/{{shipData.name}}/',
state: {
    pageSize: 10
},
mode: "client" // page entirely on the client side
});
var PageablePowerplants = Backbone.PageableCollection.extend({
model: Items,
url : '/items/get/type/powerplant/compatible-with-vehicle/{{shipData.name}}/',
state: {
    pageSize: 10
},
mode: "client" // page entirely on the client side
});
var PageableRadars = Backbone.PageableCollection.extend({
model: Items,
url : '/items/get/type/radar/compatible-with-vehicle/{{shipData.name}}/',
state: {
    pageSize: 10
},
mode: "client" // page entirely on the client side
});
var PageableWeapons = Backbone.PageableCollection.extend({
model: Items,
url : '/items/get/type/weapon/compatible-with-vehicle/{{shipData.name}}/',
state: {
    pageSize: 10
},
mode: "client" // page entirely on the client side
});
var PageableThrusters = Backbone.PageableCollection.extend({
model: Items,
url : '/items/get/type/thruster/compatible-with-vehicle/{{shipData.name}}/',
state: {
    pageSize: 10
},
mode: "client" // page entirely on the client side
});

var pageableAvionics = new PageableAvionics(),
initialAvionics = pageableAvionics;

var pageableBatteries = new PageableBatteries(),
initialBatteries = pageableBatteries;

var pageableCargo = new PageableCargo(),
initialCargo = pageableCargo;

var pageableCooler = new PageableCooler(),
initialCooler = pageableCooler;

var pageableDisplays = new PageableDisplays(),
initialDisplays = pageableDisplays;

var pageableRadars = new PageableRadars(),
initialRadars = pageableRadars;

var pageablePowerplants = new PageablePowerplants(),
initialPowerplants = pageablePowerplants;


var pageableWeapons = new PageableWeapons(),
initialWeapons = pageableWeapons;

var pageableThrusters = new PageableThrusters(),
initialThrusters = pageableThrusters;

var ItemTypeCell = Backgrid.StringCell.extend({
    className : "item-type-cell"
});
var ItemSubTypeCell = Backgrid.StringCell.extend({
    className : "item-subtype-cell"
});
var ItemSizeCell = Backgrid.StringCell.extend({
    className : "item-size-cell"
});
var ItemNameCell = Backgrid.StringCell.extend({
    className : "item-name-cell"
});

var ClickableRow = Backgrid.Row.extend({
    className:"vehicle-item-row",
    events: {
        "click": "onClick"
    },
    onClick: function () {
        Backbone.trigger("rowclicked", this.model);
    }
});

function createBackgrid(collection, parentElement){
    var columns = [{
        name: "displayName",
        label: "Item",
        editable : false,
        // The cell type can be a reference of a Backgrid.Cell subclass, any Backgrid.Cell subclass instances like *id* above, or a string
        cell: "string" // This is converted to "StringCell" and a corresponding class in the Backgrid package namespace is looked up
    },{
        name: "type",
        label: "type",
        editable : false,
        renderable: false,
        // The cell type can be a reference of a Backgrid.Cell subclass, any Backgrid.Cell subclass instances like *id* above, or a string
        cell: ItemTypeCell // This is converted to "StringCell" and a corresponding class in the Backgrid package namespace is looked up
    },{
        name: "subtype",
        label: "subtype",
        editable : false,
        renderable: false,
        // The cell type can be a reference of a Backgrid.Cell subclass, any Backgrid.Cell subclass instances like *id* above, or a string
        cell: ItemSubTypeCell // This is converted to "StringCell" and a corresponding class in the Backgrid package namespace is looked up
    },{
        name: "size",
        label: "size",
        editable : false,
        renderable: false,
        // The cell type can be a reference of a Backgrid.Cell subclass, any Backgrid.Cell subclass instances like *id* above, or a string
        cell: ItemSizeCell // This is converted to "StringCell" and a corresponding class in the Backgrid package namespace is looked up
    },{
        name: "name",
        label: "name",
        editable : false,
        renderable: false,
        // The cell type can be a reference of a Backgrid.Cell subclass, any Backgrid.Cell subclass instances like *id* above, or a string
        cell: ItemNameCell // This is converted to "StringCell" and a corresponding class in the Backgrid package namespace is looked up
    }
    ]

    var pageableGrid = new Backgrid.Grid({
        columns: columns,
        row : ClickableRow,
        collection: collection,
        footer: Backgrid.Extension.Paginator.extend({
            //okendoken. rewrite template to add pagination class to container
            template: _.template('<tr><td class="pagination" colspan="<%= colspan %>"><ul><% _.each(handles, function (handle) { %><li <% if (handle.className) { %>class="<%= handle.className %>"<% } %>><a href="#" <% if (handle.title) {%> title="<%= handle.title %>"<% } %>><%= handle.label %></a></li><% }); %></ul></td></tr>')
        }),
        className: 'table table-condensed no-margin table-hover'
    });
    parentElement.html(pageableGrid.render().$el);
}

var tableResize;
$(window).resize(function(e) {
    clearTimeout(tableResize);
    tableResize = setTimeout(function(){
        createBackgrid(pageableAvionics, $("#table-dynamic-avionics"));
        createBackgrid(pageableBatteries, $("#table-dynamic-batteries"));
        createBackgrid(pageableCargo, $("#table-dynamic-cargo"));
        createBackgrid(pageableCooler, $("#table-dynamic-cooler"));
        createBackgrid(pageableDisplays, $("#table-dynamic-displays"));
        createBackgrid(pageableRadars, $("#table-dynamic-radar"));
        createBackgrid(pageablePowerplants, $("#table-dynamic-powerplants"));
        createBackgrid(pageableWeapons, $("#table-dynamic-weapons"));
        createBackgrid(pageableThrusters, $("#table-dynamic-thrusters"));
        }, 200);
});

createBackgrid(pageableAvionics, $("#table-dynamic-avionics"));
createBackgrid(pageableBatteries, $("#table-dynamic-batteries"));
createBackgrid(pageableCargo, $("#table-dynamic-cargo"));
createBackgrid(pageableCooler, $("#table-dynamic-coolers"));
createBackgrid(pageableDisplays, $("#table-dynamic-displays"));
createBackgrid(pageableRadars, $("#table-dynamic-radar"));
createBackgrid(pageablePowerplants, $("#table-dynamic-powerplants"));
createBackgrid(pageableWeapons, $("#table-dynamic-weapons"));
createBackgrid(pageableThrusters, $("#table-dynamic-thrusters"));

pageableAvionics.fetch();
pageableBatteries.fetch();
pageableCargo.fetch();
pageableCooler.fetch();
pageableDisplays.fetch();
pageableRadars.fetch();
pageablePowerplants.fetch();
pageableWeapons.fetch();
pageableThrusters.fetch();

/***************************
// End Backgrid
***************************/






/******************************************************************************
// Set up Modal Dialogs 
******************************************************************************/

$('#item-details-modal').modal({
    backdrop: false,
    show: false
})

$('#itemport-details-modal').modal({
    backdrop: false,
    show: false
})

$('#user-login').modal({
    backdrop: true,
    show: false
})

$('#user-newuser').modal({
    backdrop: true,
    show: false
})

$('#quick-variant').modal({
    backdrop: true,
    show: false    
})

/******************************************************************************
// Bind Events  
******************************************************************************/

$("a.type-select").on("click", function(e){
    var anchor = $(this).attr("href");
    var activeItemType = anchor.split("-")[1];
    toggleItemPorts(activeItemType);
});

Backbone.on("rowclicked", function (model) {
    getItemDetails(model.get("name"));
    chartPipe(model.get("name"), "Power", "All");
    chartPipe(model.get("name"), "Heat", "All");
    chartPipe(model.get("name"), "Avionics", "All");
    $("#itemport-details-modal").modal("hide");
    $("#item-details-modal").modal("show");
});        

$(".icon-remove").on("click", function(event){
    event.stopPropagation();
    var portWell = $(this).parent()
    var portName = portWell.attr("data-port-name");
    removeItemFromPort(portName);
});

$(".item-port-label").hoverIntent({
        over: enterPortLabel,
        timeout: 100,
        out: leavePortLabel
    });

$(".item-port").hoverIntent({
        over: enterPort,
        timeout: 100,
        out: leavePort
    });

$(".item-port").on("click", function(event){
    var portName = $(this).attr("id");
    filterByItemPort(portName);
});

$(".icon-filter").on("click", function(event){
    event.stopPropagation();
    var portWell = $(this).parent()
    var portName = portWell.attr("data-port-name");
    filterByItemPort(portName);
});

$(".item-port-label").on("click", function(){
    $("#item-details-modal").modal("hide");
    $("#itemport-details-modal").modal("show");
    var portName = $(this).attr("data-port-name")
    getItemPortDetails(portName);
});

$(".item-port-datablock").on("click", function(){
    $("#item-details-modal").modal("hide");
    $("#itemport-details-modal").modal("show");
    var portName = $(this).attr("data-port-name")
    getItemPortDetails(portName);
});

$(document).on("mouseenter", "tr.vehicle-item-row", function(){
    $(this).draggable({
      revert: "invalid",
      containment: "document",
      helper: "clone",
      cursor: "move",
      delay: 100,
      distance: 5
    })
});

$("#user-action-login").on("click", function(event) {
    event.preventDefault();
    $("#user-login").modal("show");
});

$("#user-action-logout").on("click", function(event) {
    event.preventDefault();
    submitUserLogout();
});

$("#user-action-newuser").on("click", function(event) {
    event.preventDefault();
    $("#user-newuser").modal("show");
});

$("#system-action-quickvariant").on("click", function(event){
    event.preventDefault();
    getQuickVariant();
});

function loadVariantData()
{
    for (var i=0; i < variantData.length; i++)
    {
        var portName = variantData[i]['portName'];
        var itemData = {
            "displayName"   : variantData[i]['itemDisplayName'],
            "name"          : variantData[i]['itemName']
        }

        addItemToPort(portName, itemData);        
    }
}
loadVariantData();
toggleItemPorts("Weapon");
computeStats();
{% if user.is_authenticated %}
setUserState(true);
{% else %}
setUserState(false);
{% endif %}

{% endblock ready-script %}